import{a as y}from"./chunk-PJWGF4NK.js";import{P as n,Q as c}from"./chunk-N46ENOW6.js";import{k as u}from"./chunk-ETXJNP3A.js";import{J as d,S as l,_ as h,ea as m}from"./chunk-45DPJSY7.js";import{a as o,b as p}from"./chunk-FP7EQKGB.js";var w=(()=>{class a extends n{constructor(){super({projects:[],loading:!1,error:null}),this.projects$=this.select(t=>t.projects),this.loading$=this.select(t=>t.loading),this.error$=this.select(t=>t.error),this.summeryService=m(y),this.http=m(u),this.setProjects=this.updater((t,e)=>p(o({},t),{projects:e})),this.weeklyReport=this.effect(t=>t.pipe(d(e=>(this.patchState({loading:!0,error:null}),this.summeryService.postWeeklySummary(e).pipe(c(r=>{this.setProjects(r)},r=>{this.patchState({loading:!1,error:r?.message??"Unknown error"})})))))),this.getDetails=this.effect(t=>t.pipe(l(()=>this.summeryService.getProjectDetails().pipe(c(e=>{this.setProjects(e)},e=>{this.patchState({error:"Failed to load project details"})}))))),this.addEmployeeTask=this.effect(t=>t.pipe(l(e=>this.summeryService.postWeeklyReport(e.project_id,e).pipe(c(()=>{this.patchState(r=>({projects:r.projects.map(s=>s.project_name===e.projectName?p(o({},s),{employees:s.employees.some(i=>i.employee_id===e.employeeId)?s.employees.map(i=>i.employee_id===e.employeeId?p(o({},i),{daily_updates:[...i.daily_updates,e.daily_updates]}):i):[...s.employees,{employee_id:e.employeeId,employee_name:"New Employee",daily_updates:[e.daily_updates]}]}):s)}))},r=>{})))))}static{this.\u0275fac=function(e){return new(e||a)}}static{this.\u0275prov=h({token:a,factory:a.\u0275fac})}}return a})();export{w as a};
